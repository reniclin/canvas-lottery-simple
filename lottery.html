<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ½ç±¤</title>
    <style>
        :root {
            --primary-color: #2196F3;
            --primary-hover: #1976D2;
            --success-color: #4CAF50;
            --danger-color: #ff4444;
            --bg-color: #f4f7f6;
            --panel-bg: #ffffff;
            --border-color: #e0e0e0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            height: 100vh;
            overflow: hidden;
            display: grid;
            grid-template-columns: 1fr 3fr 1fr;
            grid-template-rows: 100vh;
        }

        /* --- é€šç”¨é¢æ¿æ¨£å¼ --- */
        .panel {
            background: var(--panel-bg);
            padding: 20px;
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            height: 100%;
            box-sizing: border-box;
        }

        .panel.right {
            border-right: none;
            border-left: 1px solid var(--border-color);
            background-color: #fafafa;
        }

        h2,
        h3 {
            margin: 0 0 15px 0;
            color: #333;
            font-size: 1.2rem;
            text-align: center;
        }

        /* --- å·¦å´ï¼šåƒèˆ‡è€…å€ --- */
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
        }

        input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 100%;
            box-sizing: border-box;
        }

        button {
            padding: 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: opacity 0.2s;
        }

        button:hover {
            opacity: 0.9;
        }

        #add-btn {
            background-color: var(--success-color);
            color: white;
        }

        .scroll-list {
            flex: 1;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 5px;
        }

        .list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
            background: #fff;
            margin-bottom: 2px;
        }

        .participant-info {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .color-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
        }

        .delete-btn {
            color: #aaa;
            cursor: pointer;
            padding: 2px 6px;
        }

        .delete-btn:hover {
            color: var(--danger-color);
            background: #fee;
            border-radius: 4px;
        }

        #reset-btn {
            background-color: var(--danger-color);
            color: white;
            margin-top: 15px;
        }

        /* --- ä¸­é–“ï¼šæŠ½çç®± --- */
        .center-stage {
            position: relative;
            background-color: var(--bg-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        #canvas-container {
            width: 100%;
            height: 80%;
            background: white;
            border: 8px solid #333;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        #start-btn {
            margin-top: 20px;
            padding: 15px 50px;
            font-size: 1.5rem;
            background-color: var(--primary-color);
            color: white;
            border-radius: 50px;
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.4);
        }

        #start-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            box-shadow: none;
        }

        #winner-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 5rem;
            font-weight: 800;
            color: #333;
            pointer-events: none;
            opacity: 0;
            transition: all 0.3s;
            z-index: 20;
            text-align: center;
            white-space: nowrap;
        }

        /* --- å³å´ï¼šç²çåå–® --- */
        .winner-item {
            padding: 12px;
            background-color: #fff3cd;
            border-left: 5px solid #ffc107;
            margin-bottom: 8px;
            border-radius: 4px;
            font-weight: bold;
            animation: slideIn 0.3s ease-out;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .winner-rank {
            font-size: 0.8em;
            color: #856404;
            margin-right: 10px;
        }

        @keyframes slideIn {
            from {
                transform: translateX(20px);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* --- Custom Modal Dialog (å…±ç”¨æ¨£å¼) --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-box {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            width: 300px;
            text-align: center;
            transform: scale(0.8);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .modal-overlay.active .modal-box {
            transform: scale(1);
        }

        .modal-title {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: #333;
        }

        .modal-desc {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .modal-btn {
            padding: 8px 20px;
            border-radius: 6px;
            cursor: pointer;
            border: none;
            font-weight: bold;
        }

        /* æŒ‰éˆ•æ¨£å¼ */
        .btn-cancel {
            background: #e0e0e0;
            color: #333;
        }

        .btn-cancel:hover {
            background: #d0d0d0;
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background: #e04040;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
            min-width: 80px;
        }

        .btn-primary:hover {
            background: var(--primary-hover);
        }

        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #aaa;
        }
    </style>
</head>

<body>

    <div class="modal-overlay" id="confirm-modal">
        <div class="modal-box">
            <h3 class="modal-title">ç¢ºå®šè¦é‡ç½®å—ï¼Ÿ</h3>
            <p class="modal-desc">æ­¤å‹•ä½œå°‡æ¸…ç©ºæ‰€æœ‰åƒèˆ‡è€…åå–®ã€çƒé«”èˆ‡ç²çç´€éŒ„ï¼Œä¸”ç„¡æ³•å¾©åŸã€‚</p>
            <div class="modal-buttons">
                <button class="modal-btn btn-cancel" id="modal-cancel">å–æ¶ˆ</button>
                <button class="modal-btn btn-danger" id="modal-confirm">ç¢ºå®šæ¸…ç©º</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="alert-modal">
        <div class="modal-box">
            <h3 class="modal-title" id="alert-title">æç¤º</h3>
            <p class="modal-desc" id="alert-desc">é€™è£¡é¡¯ç¤ºæç¤ºè¨Šæ¯</p>
            <div class="modal-buttons">
                <button class="modal-btn btn-primary" id="alert-ok">ç¢ºå®š</button>
            </div>
        </div>
    </div>

    <div class="panel">
        <h2>ğŸ‘¥ åƒèˆ‡è€…</h2>
        <div class="input-group">
            <input type="text" id="input-name" placeholder="åå­— (Name)" autocomplete="off">
            <input type="number" id="input-weight" placeholder="æ¬Šé‡ (1-999)" value="1" min="1" max="999">
            <button id="add-btn">åŠ å…¥åå–®</button>
        </div>

        <div style="font-size:0.9em; color:#666; margin-bottom:5px;">
            ç›®å‰äººæ•¸: <span id="count">0</span> | çƒæ•¸: <span id="ball-count">0</span>
        </div>

        <div class="scroll-list" id="participant-list">
        </div>

        <button id="reset-btn">ğŸ”„ é‡ç½® (Reset)</button>
    </div>

    <div class="center-stage">
        <div id="canvas-container">
            <canvas id="simulation"></canvas>
            <div id="winner-overlay">WINNER</div>
        </div>
        <button id="start-btn">é–‹å§‹æŠ½çƒ (Start)</button>
    </div>

    <div class="panel right">
        <h2>ğŸ† ç²çåå–®</h2>
        <div class="scroll-list" id="winner-list">
        </div>
    </div>

    <script>
        const MAX_WEIGHT_PER_PERSON = 999;

        const canvas = document.getElementById('simulation');
        const ctx = canvas.getContext('2d');
        const container = document.getElementById('canvas-container');

        let width, height;

        function resizeCanvas() {
            width = container.clientWidth;
            height = container.clientHeight;
            canvas.width = width;
            canvas.height = height;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        let participants = [];
        let balls = [];
        let particles = [];
        let winnerCount = 0;

        // Game States
        const STATE = {
            IDLE: 0,
            ROLLING: 1,
            SHOWCASE: 2, // é¸ä¸­çƒé£›å‡º/æ”¾å¤§
            REVEAL: 3    //é¡¯ç¤ºåå­—
        };
        let currentState = STATE.IDLE;
        let showcaseBall = null; // store the winning ball object
        let showcaseTimer = 0;

        const nameInput = document.getElementById('input-name');
        const weightInput = document.getElementById('input-weight');
        const listEl = document.getElementById('participant-list');
        const countEl = document.getElementById('count');
        const ballCountEl = document.getElementById('ball-count');
        const winnerListEl = document.getElementById('winner-list');
        const startBtn = document.getElementById('start-btn');
        const resetBtn = document.getElementById('reset-btn');
        const winnerOverlay = document.getElementById('winner-overlay');

        // --- Modals é‚è¼¯ ---

        // Confirm Modal (é‡ç½®)
        const confirmModal = document.getElementById('confirm-modal');
        const modalCancelBtn = document.getElementById('modal-cancel');
        const modalConfirmBtn = document.getElementById('modal-confirm');

        // Alert Modal (æç¤º)
        const alertModal = document.getElementById('alert-modal');
        const alertTitle = document.getElementById('alert-title');
        const alertDesc = document.getElementById('alert-desc');
        const alertOkBtn = document.getElementById('alert-ok');

        // å°è£è‡ªè¨‚ Alert å‡½å¼
        function showCustomAlert(title, message) {
            alertTitle.innerText = title;
            alertDesc.innerText = message;
            alertModal.classList.add('active');
            alertOkBtn.focus(); // è®“ç„¦é»è·‘åˆ°æŒ‰éˆ•ä¸Šï¼Œæ–¹ä¾¿æŒ‰ Enter é—œé–‰
        }

        alertOkBtn.addEventListener('click', () => {
            alertModal.classList.remove('active');
        });

        // é‡ç½®æŒ‰éˆ• -> é–‹å•Ÿ Confirm Modal
        resetBtn.addEventListener('click', () => {
            confirmModal.classList.add('active');
        });

        modalCancelBtn.addEventListener('click', () => {
            confirmModal.classList.remove('active');
        });

        modalConfirmBtn.addEventListener('click', () => {
            executeReset();
            confirmModal.classList.remove('active');
        });

        // é»æ“Šé®ç½©é—œé–‰ä»»æ„ Modal
        [confirmModal, alertModal].forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('active');
                }
            });
        });

        // Esc éµé—œé–‰ä»»æ„ Modal
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                confirmModal.classList.remove('active');
                alertModal.classList.remove('active');
            }
        });

        // --- ä¸»ç¨‹å¼é‚è¼¯ ---

        document.getElementById('add-btn').addEventListener('click', addParticipant);

        nameInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') addParticipant(); });
        weightInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') addParticipant(); });

        function getRandomColor() {
            const hue = Math.floor(Math.random() * 360);
            return `hsl(${hue}, 70%, 60%)`;
        }

        function getSecureRandomIndex(max) {
            if (max <= 0) return 0;
            const array = new Uint32Array(1);
            window.crypto.getRandomValues(array);
            const randomFloat = array[0] / (0xFFFFFFFF + 1);
            return Math.floor(randomFloat * max);
        }

        function addParticipant() {
            const name = nameInput.value.trim();
            let weight = parseInt(weightInput.value);

            if (!name || isNaN(weight) || weight < 1) {
                // æ›¿æ›ï¼šshowCustomAlert
                showCustomAlert("è¼¸å…¥éŒ¯èª¤", "è«‹è¼¸å…¥æœ‰æ•ˆçš„åå­—å’Œæ¬Šé‡");
                return;
            }

            if (weight > MAX_WEIGHT_PER_PERSON) {
                // æ›¿æ›ï¼šshowCustomAlert
                showCustomAlert("æ¬Šé‡éå¤§", `å–®äººæ¬Šé‡è«‹å‹¿è¶…é ${MAX_WEIGHT_PER_PERSON}`);
                return;
            }

            const id = Date.now() + Math.random();
            const color = getRandomColor();

            const newParticipant = { id, name, weight, color };
            participants.push(newParticipant);

            addBallsForParticipant(newParticipant);
            renderList();

            nameInput.value = '';
            weightInput.value = '1';
            nameInput.focus();
        }

        function removeParticipant(id) {
            participants = participants.filter(p => p.id !== id);
            balls = balls.filter(b => b.ownerId !== id);
            resizeBalls();
            renderList();
        }

        function executeReset() {
            participants = [];
            balls = [];
            winnerCount = 0;
            currentState = STATE.IDLE;
            showcaseBall = null;

            listEl.innerHTML = '';
            winnerListEl.innerHTML = '';
            countEl.innerText = '0';
            ballCountEl.innerText = '0';
            nameInput.value = '';
            weightInput.value = '1';

            startBtn.disabled = false;
            startBtn.innerText = "é–‹å§‹æŠ½çƒ (Start)";

            winnerOverlay.style.opacity = 0;
            winnerOverlay.innerText = "WINNER";
            winnerOverlay.style.transform = "translate(-50%, -50%) scale(0.5)";
        }

        function renderList() {
            listEl.innerHTML = '';
            countEl.innerText = participants.length;
            ballCountEl.innerText = balls.length;

            participants.forEach(p => {
                const div = document.createElement('div');
                div.className = 'list-item';

                const infoDiv = document.createElement('div');
                infoDiv.className = 'participant-info';

                const colorDot = document.createElement('span');
                colorDot.className = 'color-dot';
                colorDot.style.backgroundColor = p.color;

                const nameSpan = document.createElement('span');
                nameSpan.textContent = p.name;

                const weightSpan = document.createElement('span');
                weightSpan.style.color = '#888';
                weightSpan.style.fontSize = '0.8em';
                weightSpan.textContent = `x${p.weight}`;

                infoDiv.appendChild(colorDot);
                infoDiv.appendChild(nameSpan);
                infoDiv.appendChild(weightSpan);

                const deleteBtn = document.createElement('span');
                deleteBtn.className = 'delete-btn';
                deleteBtn.textContent = 'âœ•';
                deleteBtn.onclick = () => removeParticipant(p.id);

                div.appendChild(infoDiv);
                div.appendChild(deleteBtn);

                listEl.appendChild(div);
            });
        }

        function addWinnerToList(name, color) {
            winnerCount++;
            const div = document.createElement('div');
            div.className = 'winner-item';
            div.style.borderLeftColor = color;

            const nameSpan = document.createElement('span');
            nameSpan.textContent = name;

            const rankSpan = document.createElement('span');
            rankSpan.className = 'winner-rank';
            rankSpan.textContent = `#${winnerCount}`;

            div.appendChild(nameSpan);
            div.appendChild(rankSpan);

            // æœ€æ–°ç²çè€…æ’åœ¨æœ€ä¸‹æ–¹ (1, 2, 3...)
            winnerListEl.appendChild(div);
            winnerListEl.scrollTop = winnerListEl.scrollHeight;
        }

        function getOptimalRadius() {
            const totalBalls = balls.length;
            if (totalBalls < 50) return 12;
            if (totalBalls < 200) return 10;
            if (totalBalls < 500) return 8;
            if (totalBalls < 1000) return 6;
            return 5;
        }

        function resizeBalls() {
            const newRadius = getOptimalRadius();
            balls.forEach(ball => ball.radius = newRadius);
        }

        function addBallsForParticipant(p) {
            for (let i = 0; i < p.weight; i++) {
                balls.push({
                    x: Math.random() * (width - 20) + 10,
                    y: Math.random() * (height - 20) + 10,
                    vx: (Math.random() - 0.5) * 5,
                    vy: (Math.random() - 0.5) * 5,
                    radius: 10,
                    color: p.color,
                    ownerId: p.id,
                    ownerName: p.name
                });
            }
            resizeBalls();
        }

        function updatePhysics() {
            // Speed multiplier based on state
            let speedMultiplier = 1.0;
            if (currentState === STATE.ROLLING) speedMultiplier = 8.0; // Faster rolling
            if (currentState === STATE.SHOWCASE) speedMultiplier = 0.5; // Slow down background
            if (currentState === STATE.REVEAL) speedMultiplier = 0.2; // Very slow background

            balls.forEach(ball => {
                // If in SHOWCASE state, handle the winning ball separately
                if (currentState === STATE.SHOWCASE && ball === showcaseBall) {
                    // Interpolate position to center
                    const targetX = width / 2;
                    const targetY = height / 2;
                    ball.x += (targetX - ball.x) * 0.1;
                    ball.y += (targetY - ball.y) * 0.1;

                    // Interpolate size
                    const targetRadius = Math.min(width, height) / 4;
                    ball.radius += (targetRadius - ball.radius) * 0.1;

                    // Keep velocity 0 to prevent drift
                    ball.vx = 0;
                    ball.vy = 0;
                    return;
                }

                // Normal physics for other balls
                ball.x += ball.vx * speedMultiplier;
                ball.y += ball.vy * speedMultiplier;

                if (ball.x - ball.radius < 0) {
                    ball.x = ball.radius;
                    ball.vx *= -1;
                } else if (ball.x + ball.radius > width) {
                    ball.x = width - ball.radius;
                    ball.vx *= -1;
                }

                if (ball.y - ball.radius < 0) {
                    ball.y = ball.radius;
                    ball.vy *= -1;
                } else if (ball.y + ball.radius > height) {
                    ball.y = height - ball.radius;
                    ball.vy *= -1;
                }
            });

            // Transition logic for SHOWCASE -> REVEAL
            if (currentState === STATE.SHOWCASE && showcaseBall) {
                showcaseTimer++;
                if (showcaseTimer > 30) { // Approx 0.5 second
                    currentState = STATE.REVEAL;
                    revealWinner();
                    createParticles(width / 2, height / 2); // Spawn confetti
                }
            }

            // Update particles
            particles.forEach((p, index) => {
                p.x += p.vx;
                p.y += p.vy;
                p.vy += 0.2; // gravity
                p.life--;
                if (p.life <= 0) particles.splice(index, 1);
            });
        }

        function createParticles(x, y) {
            for (let i = 0; i < 100; i++) {
                particles.push({
                    x: x,
                    y: y,
                    vx: (Math.random() - 0.5) * 15,
                    vy: (Math.random() - 0.5) * 15,
                    life: 100 + Math.random() * 50,
                    color: `hsl(${Math.random() * 360}, 100%, 50%)`,
                    size: Math.random() * 5 + 2
                });
            }
        }

        function draw() {
            ctx.clearRect(0, 0, width, height);

            // Draw other balls first (background)
            balls.forEach(ball => {
                if (ball === showcaseBall) return; // Draw winner last

                ctx.globalAlpha = (currentState === STATE.SHOWCASE || currentState === STATE.REVEAL) ? 0.2 : 1.0;

                ctx.beginPath();
                ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
                ctx.fillStyle = ball.color;
                ctx.fill();

                if (ball.radius > 6) { // shine effect
                    ctx.beginPath();
                    ctx.arc(ball.x - ball.radius / 3, ball.y - ball.radius / 3, ball.radius / 3, 0, Math.PI * 2);
                    ctx.fillStyle = "rgba(255,255,255,0.3)";
                    ctx.fill();
                }
            });

            ctx.globalAlpha = 1.0; // Reset alpha

            // Draw winning ball on top
            if (showcaseBall) {
                ctx.shadowBlur = 20;
                ctx.shadowColor = "rgba(0,0,0,0.5)";

                ctx.beginPath();
                ctx.arc(showcaseBall.x, showcaseBall.y, showcaseBall.radius, 0, Math.PI * 2);
                ctx.fillStyle = showcaseBall.color;
                ctx.fill();

                // Shine
                ctx.beginPath();
                ctx.arc(showcaseBall.x - showcaseBall.radius / 3, showcaseBall.y - showcaseBall.radius / 3, showcaseBall.radius / 3, 0, Math.PI * 2);
                ctx.fillStyle = "rgba(255,255,255,0.3)";
                ctx.fill();

                ctx.shadowBlur = 0; // Reset shadow
            }

            // Draw Particles
            particles.forEach(p => {
                ctx.fillStyle = p.color;
                ctx.fillRect(p.x, p.y, p.size, p.size);
            });



            if (balls.length === 0 && participants.length === 0) {
                ctx.fillStyle = "#ccc";
                ctx.font = "24px sans-serif";
                ctx.textAlign = "center";
                ctx.fillText("ç­‰å¾…åŠ å…¥...", width / 2, height / 2);
            } else if (balls.length === 0 && participants.length > 0 && currentState === STATE.IDLE) {
                ctx.fillStyle = "#ccc";
                ctx.font = "24px sans-serif";
                ctx.textAlign = "center";
                ctx.fillText("çƒå·²æŠ½å®Œ", width / 2, height / 2);
            }

            requestAnimationFrame(draw);
        }

        setInterval(updatePhysics, 16);
        draw();

        startBtn.addEventListener('click', () => {
            if (balls.length === 0) {
                showCustomAlert("ç„¡æ³•é–‹å§‹", "ç®±å­è£¡æ²’æœ‰çƒäº†ï¼");
                return;
            }

            if (currentState !== STATE.IDLE) return;

            currentState = STATE.ROLLING;
            startBtn.disabled = true;
            startBtn.innerText = "æ»¾å‹•ä¸­...";
            winnerOverlay.style.opacity = 0;
            showcaseBall = null;

            setTimeout(() => {
                selectWinner();
            }, 3000); // Roll for 3 seconds
        });

        function selectWinner() {
            const winningBallIndex = getSecureRandomIndex(balls.length);
            showcaseBall = balls[winningBallIndex];

            // Bring winning ball to front artificially by moving to end of array (optional, but render handles it)
            // Start showcase animation
            currentState = STATE.SHOWCASE;
            showcaseTimer = 0;
        }

        function revealWinner() {
            const winnerName = showcaseBall.ownerName;
            const winnerColor = showcaseBall.color;
            const winnerId = showcaseBall.ownerId;

            // Show Overlay
            winnerOverlay.innerText = winnerName;
            winnerOverlay.style.color = winnerColor;
            winnerOverlay.style.textShadow = `3px 3px 0 #fff, -3px -3px 0 #fff, 3px -3px 0 #fff, -3px 3px 0 #fff`;
            winnerOverlay.style.opacity = 1;
            winnerOverlay.style.transform = "translate(-50%, -50%) scale(1.5)"; // Zoom in text

            addWinnerToList(winnerName, winnerColor);

            // Wait then cleanup
            setTimeout(() => {
                // Remove winning ball and all other balls of same owner
                balls = balls.filter(b => b.ownerId !== winnerId);
                removeParticipant(winnerId);

                resizeBalls();

                currentState = STATE.IDLE;
                showcaseBall = null;
                startBtn.disabled = false;
                startBtn.innerText = "é–‹å§‹æŠ½çƒ (Start)";

                winnerOverlay.style.opacity = 0; // Hide overlay
                winnerOverlay.style.transform = "translate(-50%, -50%) scale(0.5)"; // Reset scale
            }, 3000); // Show winner for 3 seconds
        }

        function showWinnerEffect(name, color) {
            winnerOverlay.innerText = name;
            winnerOverlay.style.color = color;
            winnerOverlay.style.textShadow = `3px 3px 0 #fff, -3px -3px 0 #fff, 3px -3px 0 #fff, -3px 3px 0 #fff`;
            winnerOverlay.style.opacity = 1;
            winnerOverlay.style.transform = "translate(-50%, -50%) scale(1.5)";

            setTimeout(() => {
                winnerOverlay.style.transform = "translate(-50%, -50%) scale(1)";
            }, 200);
        }
    </script>
</body>

</html>